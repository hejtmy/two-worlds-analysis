---
title: "Progress report"
author: "Lukáš 'hejtmy' Hejtmánek"
date: "3 May 2018"
output: html_document
---

```{r setup, include=FALSE}
library(ggplot2)
library(dplyr)
library(restimoter)
library(navr)
library(brainvr.R)
source_folder <- function(path){
  sapply(list.files(pattern = "[.]R$", path = path, full.names = TRUE), source);
}
source_folder("../TwoWorlds/")

sop_all <- read.table("../sop.csv", sep=";", header = T, stringsAsFactors = F)
walk_all <- read.table("../walk.csv", sep=";", header = T, stringsAsFactors = F)
load("../multi.data")
load("../settings.data")
df_participants <- settings$participants
df_participants$condition <- paste0(df_participants$First.phase, "-", df_participants$Second.phase)
```

# Results

## Distance

Distance absolute - in Unity units and in 
```{r, echo = F,warning=FALSE}
ggplot(walk_all, aes(x = condition, y = distance, fill=factor(phase))) +
  stat_summary(fun.data=mean_cl_normal,position=position_dodge(0.95),geom="errorbar") + 
  stat_summary(fun.y=mean,position=position_dodge(width=0.95),geom="bar")
```

Distance normalised - path traveled (in Unity/real) divided by the shortest path for the particular path. 

1 = traveled the exactly as needed, 2 = traveled twice more than needed

```{r, echo = F, warning=FALSE}
ggplot(walk_all, aes(x = condition, y = min_norm_distance, fill=factor(phase))) +
  stat_summary(fun.data=mean_cl_normal,position=position_dodge(0.95),geom="errorbar") + 
  stat_summary(fun.y=mean,position=position_dodge(width=0.95),geom="bar")
```

T tests comparing the normalised distance in the first and second phase.

```{r, echo = F}
walk_all %>% 
  group_by(condition) %>% 
  summarise(p.value = t.test(min_norm_distance ~ phase)$p.value,
            phase1 = t.test(min_norm_distance ~ phase)$estimate[[1]],
            phase2 = t.test(min_norm_distance ~ phase)$estimate[[2]])
```

There seems to be little to no effect of the condition on the improvement, acording to a simple anova. Effect of condition is apparent, but the improvement seems across the board, even in the Vr-vr condition, where the reasults are the same as in the real-real in the second phase.

```{r, echo = T}
aov_distance_condition <- aov(min_norm_distance~condition*phase, 
                              data = walk_all)
summary(aov_distance_condition)
```

## Time

Time absolute in seconds

```{r, echo = F,warning=FALSE}
ggplot(walk_all, aes(x = condition, y = time, fill=factor(phase))) +
  stat_summary(fun.data=mean_cl_normal,position=position_dodge(0.95),geom="errorbar") + 
  stat_summary(fun.y=mean,position=position_dodge(width=0.95),geom="bar")
```

Time normalised  - time traveled (in Unity/real) divided by the shortest time for the particular path (Jacob's office to Emily's)

1 = traveled the minimum time(exactly as needed), 2 = traveled twice longer than needed, etc
```{r, echo = F,warning=FALSE}
ggplot(walk_all, aes(x = condition, y = min_norm_time, fill=factor(phase))) +
  stat_summary(fun.data=mean_cl_normal,position=position_dodge(0.95),geom="errorbar") + 
  stat_summary(fun.y=mean,position=position_dodge(width=0.95),geom="bar")
```

T tests comparing the normalised time in the first and second phase.

```{r, echo = F}
walk_all %>% 
  group_by(condition) %>% 
  summarise(p.value = t.test(min_norm_time ~ phase)$p.value,
            phase1 = t.test(min_norm_time ~ phase)$estimate[[1]],
            phase2 = t.test(min_norm_time ~ phase)$estimate[[2]])
```

Unlike the distance, there seems to be an effect between time and phase - it is probaby due to the vast spread and longer times we can see in the virtual reality, and increase of time needed int the real-vr condition.

```{r, echo = T}
aov_time_condition <- aov(min_norm_time~condition*phase, 
                              data = walk_all)
summary(aov_time_condition)
```


## Pointing accuracy

Pointing accuracy - error in degrees.

It looks like general improvement across the board,m with bigger mistakes in vr-real condition. POssibly caused by outliers, I am looking into that. Or it might be genuinely that the environemtn change is more confusing in that case. I am waiting on the desktop data to see if there are any changes.

```{r, echo = F,warning=FALSE}
ggplot(sop_all, aes(x = condition, y = abs(error), fill=factor(phase))) +
  stat_summary(fun.data=mean_cl_normal,position=position_dodge(0.95),geom="errorbar") + 
  stat_summary(fun.y=mean,position=position_dodge(width=0.95),geom="bar")
```

There is an effect, probably caused by the real-real and vr-real conditions. but the second phase perfomance seems better again across the board, even in the vr-vr condition, getting to the level of performance of the real - real

```{r, echo = T}
aov_point_condition <- aov(abs(error)~condition*phase, 
                           data = sop_all)
summary(aov_point_condition)
```

## Number of errors
Number of wrong doors chosen

```{r, echo = F,warning=FALSE}
ggplot(walk_all, aes(x = condition, y = errors, fill=factor(phase))) +
  stat_summary(fun.data=mean_cl_normal,position=position_dodge(0.95),geom="errorbar") + 
  stat_summary(fun.y=mean,position=position_dodge(width=0.95),geom="bar")
```


# Per block stats

Condition changes in the 4th block (1-3 1st condtition, 4-6th second condition.) In case of low transfer, we should expect an upward peak in the 4th block

Normalised distance to the goal per block. There are slight (non significant, but still) bumps in the 4th block in vr-real and real-vr conditions.
```{r, echo = F,warning=FALSE}
ggplot(walk_all, aes(x = condition, y = min_norm_distance, fill=factor(exp_block_id))) +
  stat_summary(fun.data=mean_cl_normal,position=position_dodge(0.95),geom="errorbar") + 
  stat_summary(fun.y=mean,position=position_dodge(width=0.95),geom="bar")
```

Normalised time per block. There is an evident bump in real-vr condition, probably caused by the "novelty" of the treadmill. Participants trained, but now have been 45 minutes away, so there might be some "getting used to pahse". Despite longer times their number of errors is still lower than during the 3rd trial.

```{r, echo = F,warning=FALSE}
ggplot(walk_all, aes(x = condition, y = min_norm_time, fill=factor(exp_block_id))) +
  stat_summary(fun.data=mean_cl_normal,position=position_dodge(0.95),geom="errorbar") + 
  stat_summary(fun.y=mean,position=position_dodge(width=0.95),geom="bar")
```

Number of errors per block. It looks like it is decreasing nicely.

```{r, echo = F,warning=FALSE}
ggplot(walk_all, aes(x = condition, y = errors, fill=factor(exp_block_id))) +
  stat_summary(fun.data=mean_cl_normal,position=position_dodge(0.95),geom="errorbar") + 
  stat_summary(fun.y=mean,position=position_dodge(width=0.95),geom="bar")
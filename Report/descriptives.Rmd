---
title: "R Notebook"
output: github_document
---

```{r setup}
#load the participant data
library(ggplot2)
library(dplyr)
library(knitr)
library(reshape2)
library(googlesheets)
source('../Scripts/paper-prepare.R')
settings <- load_google_sheets()
df_participants <- settings$participants
df_participants <- df_participants %>% mutate(condition=paste0(First.phase,"-",Second.phase))
df_participants <- df_participants %>% filter(condition %in% c("vr-real", "real-real", "ve-real"))
overview <- settings$versions
overview <- overview %>% mutate(condition=paste0(First.phase,"-",Second.phase))
overview <- overview %>% filter(condition %in% c("vr-real", "real-real", "ve-real"))

all <- df_participants %>% left_join(overview, by="Code")
```

## Dropout ratings
```{r}
finished <- overview %>% group_by(condition) %>% count(finished)
finished <- dcast(finished, condition~finished)
finished$percent <- round(finished$yes/(finished$yes+finished$no), 2)
kable(finished)

is_ok <- overview %>% filter(finished=="yes") %>% group_by(condition) %>% count(is_ok)
is_ok <- dcast(is_ok, condition~is_ok)
is_ok$percent <- round(is_ok$yes/(is_ok$yes+is_ok$no), 2)
kable(is_ok)
```
A total of `r sum(finished$no)` participants didn't finish due to motion sickness, with about 50% not finishing the VR to VR condition.

## Female/male
```{r, echo=F}
kable(df_participants %>% right_join(overview, by='Code') %>% filter(is_ok=="yes") %>% group_by(condition, sex) %>% count)
```

# Report
A total of `r sum(overview$finished == "yes", na.rm=T)` undergraduate students at UC Davis particiapted in the study in exchange for a course credit. Each participant was randomly assigned a condition and a randomized set of goals before arrival. `r sum(finished$no)` participants didn't finish due to motion sickness and `r sum(is_ok$no)` were removed due to a technical failure of the real world tracking systen. 

Eighteen participants didn't finish due to motion sickness and three were removed due to a technical problems with the real world tracking system. This resulted in a final sample size of `r sum(overview$is_ok == "yes", na.rm=T)` participants (M = `r round(mean(df_participants[df_participants$is_ok == "yes",]$age, na.rm=T),1)`, SD = `r round(sd(df_participants[df_participants$finished == "yes",]$age, na.rm=T), 1)`) () with a mean age of ## used for all reported analyses.All procedures were approved by the UC Davis Institutional Review Board (IRB    ). 

## Descriptives for the VR/real/desktop - time and path traveled

```{r}
df_desc <- walk_all %>% group_by(type, exp_block_id) %>% summarize(mean_dist = mean(distance, na.rm=T), mean_time = mean(time, na.rm=T))
ggplot(df_desc, aes(exp_block_id, mean_dist, fill=type)) + geom_bar(stat="identity", position = "dodge")
ggplot(df_desc, aes(exp_block_id, mean_time, fill=type)) + geom_bar(stat="identity", position = "dodge")
```
